# Android-mobile-tunnel-positioning
 
隧道定位系统使用说明书


硬件环境搭建
	需要使用的硬件包括：网线、光纤、光纤收发器、路由器、安卓手机、Windows10主机。
将能够正常使用的网线与光纤收发器相连，然后将光纤收发器与光纤相连，光纤长约200m，然后将光纤的末端与光纤收发器相连，最后光纤收发器与网线相连，网线再与路由器相连。确保路由器能正常使用，能够有足够强的WIFI信号，并且像这样的路由器能够有不少于3个。之后将Windows10主机也能够在这个局域网当中。简单说安卓手机需要有WIFI能够使用，连上WIFI之后能够确保和Windows10主机在同一网段下。

离线构建指纹数据库
定位算法使用了指纹数据库算法，在正式开始定位之前需要先进行指纹数据库的收集，这里的指纹指的是地图上每个参考点的对应的WIFI信号RSSI的强度值。
 
这里收集指纹数据库使用的软件是OpenCollector软件，这个软件也是独立开发的，截图如上。使用该软件可以进行扫描手机周边的WIFI信号强度，软件将其写入到文本文件中。具体的使用方法是：
1、	点击Load Map导入地图，在导入图片后会要求输入长和宽的最大值，这个长和宽就是地图所示区域的长宽，Stride Length是步长，需要输入，。
2、	当手机位于地图上所示的位置之后点击Start按钮，手机就开始扫描周围的WIFI强度，等待5秒钟左右的时间，扫描完成后会直接写入文件中。
3、	点击地图，每次点击都会跳跃对应步长的距离，然后手机移动到对应的位置，继续重复步骤2所示的步骤，直到全部的地图位置都收集完成。
4、	检查数据，打开文件管理器，在文件夹中查找到OpenCollector文件夹，然后能够看到按照当天时间所标题的.txt文件，打开之后截图如下图。

 
服务器端搭建
该系统需要使用的客户端之间进行相互通信，所以需要搭建一个服务器来满足这些需求，客户端的搭建需要用到的工具有：MySql数据库，JAVA编译环境，定位执行java包。此外整个运行在Win10 64位系统下。
1、MySql数据库安装
首先是MySql数据库的安装，MySql是一款安全、跨平台、高效的，并与Java主流编程语言紧密结合的数据库系统。此外，MySql数据库还是一款完全免费的产品，用户可以直接通过网络下载，并且不需要支付任何费用。
本系统选用的是MySql 5.7.35 Win10 64 的版本。之后会提供安装包进行安装，或者直接在https://downloads.mysql.com/archives/community/上进行下载。
 
获取到安装包之后，双击打开，然后点击Next
 
然后再次点击next，
 
设置密码123456。
 
使用cmd指令mysql -V查看安装情况。
 
出现如上图便是安装好了。

2、安装JAVA编译环境
		JAVA编译语言是一门面向对象的编程语言，不仅吸收了C++语言的各种优点，还摒弃了C++里难以理解的多继承、指针等概念，因此JAVA语言具有功能强大和简单易用两个特征。JAVA语言作为静态面向对象语言的代表，极好地实现了面向对象理论，允许程序员以优雅的思维方式进行复杂的编程。
		本系统使用了JAVA8的版本，服务器端也同样使用了JAVA编译环境，所以在搭建服务器时需要先安装JAVA。
		安装JAVA1.8版本，需要安装程序，可以直接从https://www.oracle.com/java/technologies/downloads/#java8-windows 网址上进行下载，或者之后会提供安装包。
 
		有了安装包后直接双击打开，然后选择合适的位置进行安装，注意路径不能有中文。
 
		等安装结束还需要配置环境变量，首先进入打开系统设置，点击高级程序设置
 
然后点击环境变量
 
点击环境变量新建JAVA_HOME变量，点击浏览目录，找到你刚才安装时第一次更改的路径，然后点击确定。
 

 


找到系统变量中的path变量，选中，点击编辑新建
%JAVA_HOME%\bin   和  %JAVA_HOME%\jar\bin
 
然后确定。

 
使用cmd指令测试安装情况，输入java和javac查看，出现如下情况便已经安装完成。
 
 


3、运行定位系统jar包
		Jar包由程序员提供，运行在该电脑上，为后面的客户端的通信提供。
 
		使用cmd运行jar包，先切换到该包所在的路径，如下图。这个路径就是jar包所在的路径。
 
		然后使用:
java -jar SpingBootDemo-1.0-SNAPSHOT.jar 指令运行包。
 
运行到这里服务器便搭建完成，如果想要客户端正常运行，就要保证服务器端正常运行。
		如果遇到8080端口被占用的情况，需要先通过netstat -ano | findstr 8080指令查看PID，然后使用
taskkill -pid PID –f  关闭该任务。这里的PID是前一步查到的。

	因为后续的更新可能导致无法使用，所以可以从GitHub网站上获取到最新的代码，这样确保能够运行，SuperVirtue/Tunnel-Server (github.com)。
	将程序保存到本地，然后首先运行DataPreprocessing文件，对收集到的指纹数据库文件进行预处理，将fileName的位置更换成指纹数据库所在的位置。然后运行，得到经过处理后的数据集文件，然后再打开person.properties文件，将该文件中的fingerprint-database.file-url位置替换成预处理之后得到的文件位置。最后运行helloWorldApplication.java文件。

客户端使用
		
本系统客户端采用了安卓操作系统，主要的使用过程，包括安装软件、注册、登录、定位四步骤。
1、安装隧道定位系统客户端
		首先要得到软件安装包，可以由程序员提供，或者之后可以通过网盘及其他一些方式进行获取。软件安装包如下图。
 
		得到软件安装包之后在安装手机上双击打开，进行安装，安装步骤都正常。安装过程中会向用户请求权限，权限主要包括：请求位置信息，请求使用网络，请求使用WIFI。这些权限都是为了满足系统的正常运行所需要的。如果之后在运行的过程中发现异常，比如一些核心功能无法使用，可以回来检查一下权限是否开启。
		安装完成后会在屏幕的主界面看到，如下图。
 

点击该图标，即可启动隧道定位系统客户端软件。该软件采用了一个主体为黄色的隧道标志作为软件的快捷图标，既能展现出软件的主要作用是安全保障，又和我们的施工隧道形成关联，能快速的让用户对软件有个具体的印象。
、 
	在软件的图标处长按然后点击详细信息就能看到该客户端软件的细节，包括所占用的储存空间、使用的流量、权限等信息。

 
在进行注册和登录等操作之前需要设置服务钱IP地址以及选取隧道地图。点击软件首页面右上角三个点然后进入到Settings按钮内部，就能见到如上图，然后输入服务器IP并且选取合适的隧道地图，最后点击确定即可。

2、注册
		想要正常使用定位系统前需要先注册一个账户，进入到软件的主界面后，点击注册新用户按钮。
 
点击按钮之后会进入如下界面。
 
注册页面就如上图，需要输入的包括用户姓名、电话号码、账户、密码，然后选择一个权限即可。在点击确认时，会检查以上各项输入的正确性。姓名需要非空，电话号码需要是三大运营商提供的11位号码，账户长度限制在3-15个字符长度，并且可以使用小写字母、数字、下划线，密码则要求至少包含一个大写字母、一个小写字母、一个数字，然后长度限制在8-16位字符。权限目前只有管理员和普通用户，然后针对不同的用户之后会增加不同的可见项。
在注册页面有错误码提供查阅。
错误码	错误内容
000	输入的账户已经注册过了
001	姓名输入框为空
002	输入的电话号码不符合规范
003	输入的用户名不符合规范
004	输入的密码不符合规范
005	权限没有选择
当遇到错误可以通过翻看说明书进行查找对应的解决办法，错误码在页面中的展现如下图。通过错误码也可以更准确描述当前遇到的问题。
 
如果输入的信息都正确，那么确定之后便可以直接登录了，按照刚才输入的账户和密码。

3、登录
		有了注册过的账号便可以尝试登录了，但是在一些情况下也会出现错误，如下图就是当网络出现错误时的状况。
 
    上图所示的错误时，首先要查看软件的网络访问权限有没有开启，如果开启，那么就要检查服务器是否正常运行。需要注意的是客户端的手机需要和服务器端网络在统一的网段下才可以，简单说就是需要在同一个WIFI的网络下或者在同一个局域网当中才可以。
		此外就是界面左下角的记住密码和右下角的自动登录可选框，在输入密码之后勾选然后登录就可以具有相应的功能。
4、定位
		定位功能，便是该系统最核心的功能，该功能界面如下。
 
在界面的左上角是具体的位置预测，即系统判断你当前所处的位置坐标。然后下面是地图，你当前所处位置的可视化。以上截图中使用的地图是测试中所在环境的地图，之后通过代码方式更换为隧道地图。更换完成后，在服务器端也需要进行设置。这里的地图可以通过双击、两指拖动的方式进行缩放，但是最小和最大缩放都是有限制的。如下图就是进行放大后的结果，缩小的最小限制就是图片的宽等于屏幕的宽。
 
在地图界面的下方是刷新按钮，通过点击这个按钮来获取到实时的位置信息。简单的使用方式就是当走到一个位置，你想知道你当前位于地图上的哪个位置时，你就点击一下刷新按钮，然后屏幕中央的地图就会将你的位置在地图上标识出来。
在定位功能这里提供了权限分离，管理员看到的数据除了自己当前的位置，还有最近的十分钟内全部其他人的位置，如下图，当中蓝色的点是管理员的位置，红色的点是其他用户的位置信息。普通用户能看到的只有自己的位置。		
 



